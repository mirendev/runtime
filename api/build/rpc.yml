apiVersion: miren.dev/rpc/v1
kind: IDL

imports:
  stream:
    path: ../../pkg/rpc/stream/stream.yml
    import: miren.dev/runtime/pkg/rpc/stream

types:
  - type: Status
    fields:
      - name: kind
        type: string
        index: 0
      - name: update
        type: union
        union:
          - name: message
            type: string
            index: 1
          - name: buildkit
            type: bytes
            index: 2

interfaces:
  - name: Stream
    methods:
      - name: recv
        parameters:
          - name: count
            type: int32
        results:
          - name: data
            type: bytes

  - name: Builder
    methods:
      - name: buildFromTar
        parameters:
          - name: application
            type: string
          - name: tardata
            type: stream.RecvStream[[]byte]
          - name: status
            type: stream.SendStream[*Status]
        results:
          - name: version
            type: string


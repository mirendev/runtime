services:
  etcd:
    image: oci.miren.cloud/etcd:v1
    container_name: miren-etcd
    ports:
      - "2379:2379"
    command:
      - etcd
      - --listen-client-urls=http://0.0.0.0:2379
      - --advertise-client-urls=http://etcd:2379
      - --listen-peer-urls=http://0.0.0.0:2380
      - --initial-advertise-peer-urls=http://etcd:2380
      - --initial-cluster=default=http://etcd:2380
      - --data-dir=/etcd-data
    volumes:
      - etcd-data:/etcd-data
    networks:
      - miren-dev

  clickhouse:
    image: oci.miren.cloud/clickhouse:v2
    container_name: miren-clickhouse
    ports:
      - "9000:9000"
      - "8123:8123"
    environment:
      - CLICKHOUSE_DEFAULT_ACCESS_MANAGEMENT=1
      - CLICKHOUSE_PASSWORD=default
    volumes:
      - clickhouse-data:/var/lib/clickhouse
    networks:
      - miren-dev

  minio:
    image: oci.miren.cloud/minio:v1
    container_name: miren-minio
    ports:
      - "9001:9000"  # Map to 9001 on host to avoid conflict with clickhouse
    environment:
      - MINIO_ROOT_USER=admin
      - MINIO_ROOT_PASSWORD=password
      - MINIO_UPDATE=off
    command:
      - minio
      - server
      - /data
    volumes:
      - minio-data:/data
    networks:
      - miren-dev

networks:
  miren-dev:
    name: miren-dev

volumes:
  etcd-data:
  clickhouse-data:
  minio-data:
